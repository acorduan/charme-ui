<div aiq-menu
     class="cursor-pointer relative w-full"
     [ngClass]="{'pointer-events-none': disabled}"
     [aiqMenuTrigger]="optionsTpl"
     [(aiqMenuOpen)]="open">
  <ng-container *ngTemplateOutlet="buttonTpl || defaultDropdown"></ng-container>
</div>

<ng-template #defaultDropdown>
  <div
    aiq-input
    [label]="label"
    class="relative flex items-center justify-between "
    [disabled]="disabled"
    (click)="onDropdownClick()"
    (mouseenter)="hoverTrigger && (open = true)"
    (mouseleave)="hoverTrigger && (open = false)"
  >

    <ng-container *ngIf="!multipleSelect">
      <span *ngIf="value" class="text-md" aiq-ellipsis>{{ optionLabel ? (value | aiqNestedValue : optionLabel) : value }}</span>
      <span *ngIf="!value" class="text-sm placeholder" aiq-ellipsis>{{ clearValue ?? placeholder }}</span>
    </ng-container>

    <ng-container *ngIf="multipleSelect">
      <span class="text-md" *ngIf="value?.length">
          <ng-container *ngFor="let item of value; let valueIndex = index">
            <ng-container *ngIf="item | valueInOptions : _options : optionLabel">
              {{( optionLabel ? (item | aiqNestedValue : optionLabel) : item) + (valueIndex < value.length - 1 ? '; ' : '') }}
            </ng-container>
        </ng-container>
      </span>
      <span *ngIf="!value?.length" class="text-sm placeholder">{{placeholder}}</span>
    </ng-container>

    <span class="material-icons-outlined text-md">expand_more</span>
  </div>

</ng-template>

<ng-template #optionsTpl >
  <div
    class="max-h-96 overflow-y-auto py-2"
    (mouseenter)="hoverTrigger && (open = true)"
    (mouseleave)="hoverTrigger && (open = false)"
  >
    <ng-container *ngIf="!multipleSelect">
      <button aiq-button
              size="large"
              class="!justify-between gap-4 !rounded-none w-full"
              [id]="'aiq-dropdown-option_' + index"
              [selected]="value | optionSelected : option : (optionLabel ?? '') : valueAsProp"
              (click)="onOptionClick(index, $event)"
              *ngFor="let option of _options; let index = index">
        <span class="text-md">{{ index === 0 && allowClear ? option : optionLabel ? (option | aiqNestedValue : optionLabel) : option }}</span>
        <span *ngIf="value | optionSelected : option : (optionLabel ?? '') : valueAsProp"
              class="material-icons-outlined text-md">done</span>
      </button>
    </ng-container>

    <ng-container *ngIf="multipleSelect">
      <button aiq-button
              size="large"
              class="!justify-start !rounded-none w-full"
              [selected]="value && value.indexOf(option) !== -1"
              [disabled]="value && multipleLimit && !(value.indexOf(option) !== -1) && value.length === multipleLimit"
              (click)="onOptionClick(index, $event)"
              [id]="'aiq-dropdown-multiple-option_' + index"
              *ngFor="let option of _options; let index = index">
        <input aiq-checkbox [id]="'option-' + index" class="pointer-events-none" type="checkbox"
               [ngModel]="value && value.indexOf(option) !== -1">
        <label [for]="'option-' + index"
               class="text-md pointer-events-none">{{ optionLabel ? (option | aiqNestedValue : optionLabel) : option }}</label>
      </button>
    </ng-container>

  </div>
</ng-template>
